<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Temple Run 2D - Advanced</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      background: #333;
    }
    #gameCanvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }
    .parallax {
      position: fixed;
      top: 0;
      left: 0;
      width: 200%;
      height: 100%;
      background-repeat: repeat-x;
      background-size: cover;
      z-index: 0;
      animation: scroll 60s linear infinite;
    }
    .bg1 {
      background-image: linear-gradient(to top, #2e8b57, #6b8e23);
      z-index: -3;
      animation-duration: 80s;
    }
    .bg2 {
      background-image: linear-gradient(to top, rgba(0,0,0,0.2), rgba(0,0,0,0));
      z-index: -2;
      animation-duration: 40s;
    }
    .bg3 {
      background-image: url('data:image/svg+xml;utf8,<svg width="800" height="200" xmlns="http://www.w3.org/2000/svg"><rect width="800" height="200" fill="%23221010"/><circle cx="400" cy="100" r="50" fill="%23FFD700"/></svg>');
      z-index: -1;
      animation-duration: 20s;
    }
    @keyframes scroll {
      from { transform: translateX(0); }
      to { transform: translateX(-50%); }
    }
  </style>
</head>
<body>
  <div class="parallax bg1"></div>
  <div class="parallax bg2"></div>
  <div class="parallax bg3"></div><canvas id="gameCanvas" width="800" height="400"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let score = 0;
    let speed = 5;
    let player = { x: 50, y: 300, w: 40, h: 40, vy: 0, jumping: false, doubleJump: false, shield: false };
    let gravity = 1.5;
    let obstacles = [];
    let coins = [];
    let keys = {};
    let highScore = localStorage.getItem("templeRunHighScore") || 0;
    let gameRunning = false;

    function drawPlayer() {
      ctx.fillStyle = player.shield ? "rgba(0,255,255,0.8)" : "#FFD700";
      ctx.beginPath();
      ctx.arc(player.x + player.w/2, player.y + player.h/2, player.w/2, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawObstacles() {
      ctx.fillStyle = "#8B0000";
      obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.w, o.h));
    }

    function drawCoins() {
      ctx.fillStyle = "#FFFF00";
      coins.forEach(c => ctx.beginPath(), ctx.arc(c.x, c.y, c.r, 0, Math.PI*2), ctx.fill());
    }

    function drawScore() {
      ctx.fillStyle = "white";
      ctx.font = "20px Arial";
      ctx.fillText("Score: " + score, 10, 20);
      ctx.fillText("High Score: " + highScore, 10, 40);
    }

    function update() {
      player.y += player.vy;
      player.vy += gravity;
      if (player.y > 300) { player.y = 300; player.vy = 0; player.jumping = false; player.doubleJump = false; }

      obstacles.forEach(o => o.x -= speed);
      coins.forEach(c => c.x -= speed);
      obstacles = obstacles.filter(o => o.x + o.w > 0);
      coins = coins.filter(c => c.x + c.r > 0);

      if (Math.random() < 0.02) {
        obstacles.push({ x: 800, y: 320, w: 30, h: 40 });
      }
      if (Math.random() < 0.01) {
        coins.push({ x: 800, y: 250, r: 10 });
      }

      obstacles.forEach(o => {
        if (player.x < o.x + o.w && player.x + player.w > o.x && player.y < o.y + o.h && player.y + player.h > o.y) {
          if (!player.shield) {
            gameOver();
          } else {
            player.shield = false;
          }
        }
      });

      coins.forEach((c, i) => {
        let dx = player.x + player.w/2 - c.x;
        let dy = player.y + player.h/2 - c.y;
        if (Math.sqrt(dx*dx + dy*dy) < c.r + player.w/2) {
          coins.splice(i, 1);
          score += 10;
        }
      });

      score++;
      if (score % 500 === 0) speed += 0.5;
    }

    function gameOver() {
      gameRunning = false;
      if (score > highScore) {
        highScore = score;
        localStorage.setItem("templeRunHighScore", highScore);
      }
      alert("Game Over! Score: " + score);
      location.reload();
    }

    function loop() {
      if (!gameRunning) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      update();
      drawPlayer();
      drawObstacles();
      drawCoins();
      drawScore();
      requestAnimationFrame(loop);
    }

    document.addEventListener("keydown", e => {
      if (e.code === "Space") {
        if (!player.jumping) {
          player.vy = -15;
          player.jumping = true;
        } else if (!player.doubleJump) {
          player.vy = -12;
          player.doubleJump = true;
        }
      }
      if (e.code === "KeyS") {
        player.shield = true;
        setTimeout(() => player.shield = false, 3000);
      }
    });

    function startGame() {
      gameRunning = true;
      loop();
    }

    window.onload = () => {
      if (confirm("Temple Run Game\n\nInstructions:\n- Space: Jump\n- Press again to Double Jump\n- S: Activate Shield\n\nStart game?")) {
        startGame();
      }
    };
  </script></body>
</html>
